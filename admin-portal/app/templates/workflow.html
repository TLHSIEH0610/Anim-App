{% extends "base.html" %}

{% block content %}
<h2 class="mdc-typography--headline5">Workflow for Book {{ book_id }}</h2>

<div class="mdc-card" style="padding: 16px; margin-bottom: 16px;">
    <h3 class="mdc-typography--headline6">Workflow Metadata</h3>
    <p><strong>Story Source:</strong> {{ metadata.story_source or 'custom' }}</p>
    {% if metadata.get('template_key') %}
    <p><strong>Template:</strong> {{ metadata.template_key }}</p>
    {% endif %}
    <p><strong>Page:</strong> {{ metadata.page_number }}{% if metadata.page_count %} / {{ metadata.page_count }}{% endif %}</p>
    {% if metadata.workflow_slug %}
    <p><strong>Workflow Slug:</strong> {{ metadata.workflow_slug }}</p>
    {% endif %}
    {% if metadata.workflow_version is not none %}
    <p><strong>Workflow Version:</strong> {{ metadata.workflow_version }}</p>
    {% endif %}
    {% if available_pages and available_pages|length > 1 %}
    <form method="get" action="/books/{{ book_id }}/workflow" class="form-grid one-col" style="margin-top: 8px; max-width: 360px;">
      <div class="full">
        <label for="page">Jump to page</label>
        <select id="page" name="page" class="w-100" onchange="this.form.submit()">
          {% for p in available_pages %}
            <option value="{{ p }}" {% if p == current_page %}selected{% endif %}>Page {{ p }}</option>
          {% endfor %}
        </select>
      </div>
      <noscript>
        <div class="form-actions full">
          <button type="submit" class="mdc-button mdc-button--outlined">Go</button>
        </div>
      </noscript>
    </form>
    {% endif %}
    <p><strong>Snapshot Source:</strong> {{ metadata.source }}</p>
    {% if metadata.prompt_id %}
    <p><strong>Prompt ID:</strong> {{ metadata.prompt_id }}</p>
    {% endif %}
    <p><strong>Image Filenames:</strong> {{ metadata.image_filenames }}</p>
    {% if metadata.prompt %}
    <p><strong>Positive Prompt:</strong> {{ metadata.prompt }}</p>
    {% endif %}
</div>

<div class="mdc-card" style="padding: 16px;">
    <h3 class="mdc-typography--headline6">Workflow JSON</h3>
    <pre>{{ workflow }}</pre>
</div>

<a href="/dashboard" class="mdc-button" style="margin-top: 16px;">Back to dashboard</a>
{% endblock %}
