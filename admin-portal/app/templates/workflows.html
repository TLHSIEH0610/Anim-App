{% extends "base.html" %}

{% block content %}
<h2 class="mdc-typography--headline5">Workflow Definitions</h2>

{% if request.query_params.get('error') %}
<script>
  (function(){
    try {
      var msg = new URLSearchParams(window.location.search).get('error');
      if (msg) alert(msg);
    } catch (e) {}
  })();
</script>
{% endif %}

<div class="mdc-data-table">
    <div class="mdc-data-table__table-container">
        <table class="mdc-data-table__table">
            <thead>
                <tr class="mdc-data-table__header-row">
                    <th class="mdc-data-table__header-cell slug-column">Slug</th>
                    <th class="mdc-data-table__header-cell">Name</th>
                    <th class="mdc-data-table__header-cell">Type</th>
                    <th class="mdc-data-table__header-cell">Version</th>
                    <th class="mdc-data-table__header-cell">Active</th>
                    <th class="mdc-data-table__header-cell">Actions</th>
                </tr>
            </thead>
            <tbody class="mdc-data-table__content">
                {% for workflow in workflows %}
                <tr class="mdc-data-table__row">
                    <td class="mdc-data-table__cell slug-column aa-wrap">{{ workflow.slug }}</td>
                    <td class="mdc-data-table__cell">{{ workflow.name }}</td>
                    <td class="mdc-data-table__cell">{{ workflow.type }}</td>
                    <td class="mdc-data-table__cell">{{ workflow.version }}</td>
                    <td class="mdc-data-table__cell">{{ workflow.is_active }}</td>
                    <td class="mdc-data-table__cell">
                        <div class="actions-wrap">
                          <a href="/workflows/{{ workflow.id }}" class="mdc-button btn-sm"><span class="mdc-button__label">Edit</span></a>
                          <form method="post" action="/workflows/{{ workflow.id }}/export">
                            <button type="submit" class="mdc-button btn-sm"><span class="mdc-button__label">Export</span></button>
                          </form>
                          <form method="post" action="/workflows/{{ workflow.id }}/duplicate">
                            <button type="submit" class="mdc-button btn-sm"><span class="mdc-button__label">Duplicate</span></button>
                          </form>
                          <form method="post" action="/workflows/{{ workflow.id }}/delete" onsubmit="return confirm('Delete workflow {{ workflow.slug }}?');">
                            <button type="submit" class="mdc-button btn-sm btn-danger"><span class="mdc-button__label">Delete</span></button>
                          </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<section class="mt-4">
    <h3 class="mdc-typography--headline6">Create New Workflow Version</h3>
    <form method="post" action="/workflows/create" class="form-grid one-col">
        <div class="full">
            <div class="mdc-text-field mdc-text-field--filled w-100">
                <input id="slug" name="slug" class="mdc-text-field__input" required>
                <label for="slug" class="mdc-floating-label">Slug</label>
                <div class="mdc-line-ripple"></div>
            </div>
        </div>
        <div class="full">
            <div class="mdc-text-field mdc-text-field--filled w-100">
                <input id="name" name="name" class="mdc-text-field__input" required>
                <label for="name" class="mdc-floating-label">Name</label>
                <div class="mdc-line-ripple"></div>
            </div>
        </div>
        <div class="full">
            <div class="mdc-text-field mdc-text-field--filled w-100">
                <input id="type" name="type" class="mdc-text-field__input" required>
                <label for="type" class="mdc-floating-label">Type</label>
                <div class="mdc-line-ripple"></div>
            </div>
        </div>
        <div class="full">
            <label for="content">Workflow JSON</label>
            <textarea id="content" name="content" style="min-height:320px;" placeholder="{\n  \"nodes\": [],\n  \"edges\": []\n}" required></textarea>
        </div>
        <div class="form-actions full">
          <button type="submit" class="mdc-button mdc-button--raised"><span class="mdc-button__label">Create</span></button>
        </div>
    </form>
</section>

<a href="/dashboard" class="mdc-button" style="margin-top: 2rem;">Back to dashboard</a>
{% endblock %}
