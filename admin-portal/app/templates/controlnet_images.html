{% extends "base.html" %}

{% block content %}
<h2 class="mdc-typography--headline5">Keypoint Images</h2>
<p>Upload reference keypoint masks for InstantID (node 100). Each story page can reference one of these by slug.</p>

{% if images %}
  <div class="mdc-data-table mt-3">
    <div class="mdc-data-table__table-container">
      <table class="mdc-data-table__table">
        <thead>
          <tr class="mdc-data-table__header-row">
            <th class="mdc-data-table__header-cell">Preview</th>
            <th class="mdc-data-table__header-cell">Slug</th>
            <th class="mdc-data-table__header-cell">Name</th>
            <th class="mdc-data-table__header-cell">Updated</th>
            <th class="mdc-data-table__header-cell">Actions</th>
          </tr>
        </thead>
        <tbody class="mdc-data-table__content">
          {% for image in images %}
          <tr class="mdc-data-table__row">
            <td class="mdc-data-table__cell">
              {% if image.image_path %}
                <img src="/files-proxy?path={{ image.image_path | urlencode }}" alt="{{ image.slug }}" style="max-width:140px; border-radius:10px; border:1px solid rgba(0,0,0,.12);">
              {% else %}
                <em>n/a</em>
              {% endif %}
            </td>
            <td class="mdc-data-table__cell"><code>{{ image.slug }}</code></td>
            <td class="mdc-data-table__cell">{{ image.name }}</td>
            <td class="mdc-data-table__cell">{{ image.updated_at or image.created_at or 'â€”' }}</td>
            <td class="mdc-data-table__cell">
              <div class="actions-wrap">
                <a href="/keypoint-images/{{ image.slug }}" class="mdc-button btn-sm"><span class="mdc-button__label">Edit</span></a>
                <form method="post" action="/keypoint-images/{{ image.slug }}/delete" onsubmit="return confirm('Delete keypoint image {{ image.slug }}?');">
                  <button type="submit" class="mdc-button btn-sm btn-danger"><span class="mdc-button__label">Delete</span></button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% else %}
  <p>No keypoint images yet. Upload one below to get started.</p>
{% endif %}

<section class="mt-4">
  <h3 class="mdc-typography--headline6">Upload Keypoint Image</h3>
  <form method="post" action="/keypoint-images/create" enctype="multipart/form-data" class="form-grid one-col mt-2">
    <div class="full">
      <div class="mdc-text-field mdc-text-field--filled w-100">
        <input id="create-slug" name="slug" value="{{ form_defaults.slug }}" class="mdc-text-field__input" required>
        <label for="create-slug" class="mdc-floating-label">Slug</label>
        <div class="mdc-line-ripple"></div>
      </div>
    </div>
    <div class="full">
      <div class="mdc-text-field mdc-text-field--filled w-100">
        <input id="create-name" name="name" value="{{ form_defaults.name }}" class="mdc-text-field__input" required>
        <label for="create-name" class="mdc-floating-label">Name</label>
        <div class="mdc-line-ripple"></div>
      </div>
    </div>

    <div class="full">
      <label for="create-file">Keypoint Image</label>
      <input id="create-file" type="file" name="image_file" accept="image/*" required class="w-100">
      <p style="font-size:0.85rem; opacity:.75;">PNG masks with transparent background typically work best.</p>
    </div>

    <div class="form-actions full">
      <button type="submit" class="mdc-button mdc-button--raised"><span class="mdc-button__label">Save Keypoint</span></button>
    </div>
  </form>
  </section>

<a href="/dashboard" class="mdc-button mt-4"><span class="mdc-button__label">Back to dashboard</span></a>
{% endblock %}
