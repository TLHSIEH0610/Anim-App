{% extends "base.html" %}

{% block content %}
<h2 class="mdc-typography--headline5">Story Templates</h2>

<div class="mdc-data-table">
    <div class="mdc-data-table__table-container">
        <table class="mdc-data-table__table">
            <thead>
                <tr class="mdc-data-table__header-row">
                    <th class="mdc-data-table__header-cell">Slug</th>
                    <th class="mdc-data-table__header-cell">Name</th>
                    <th class="mdc-data-table__header-cell">Age</th>
                    <th class="mdc-data-table__header-cell">Version</th>
                    <th class="mdc-data-table__header-cell">Workflow</th>
                    <th class="mdc-data-table__header-cell">Active</th>
                    <th class="mdc-data-table__header-cell">Pages</th>
                    <th class="mdc-data-table__header-cell">Actions</th>
                </tr>
            </thead>
            <tbody class="mdc-data-table__content">
                {% for story in stories %}
                <tr class="mdc-data-table__row">
                    <td class="mdc-data-table__cell">{{ story.slug }}</td>
                    <td class="mdc-data-table__cell">{{ story.name }}</td>
                    <td class="mdc-data-table__cell">{{ story.age }}</td>
                    <td class="mdc-data-table__cell">{{ story.version }}</td>
                    <td class="mdc-data-table__cell">{{ story.workflow_slug }}</td>
                    <td class="mdc-data-table__cell">{{ story.is_active }}</td>
                    <td class="mdc-data-table__cell">{{ story.page_count }}</td>
                    <td class="mdc-data-table__cell">
                        <a href="/stories/{{ story.slug }}" class="mdc-button">Edit</a>
                        <form method="post" action="/stories/{{ story.slug }}/export" style="display:inline-block; margin-left:0.5rem;">
                            <button type="submit" class="mdc-button mdc-button--outlined">Export</button>
                        </form>
                        <form method="post" action="/stories/{{ story.slug }}/delete" style="display:inline-block; margin-left:0.5rem;" onsubmit="return confirm('Delete story template {{ story.slug }}?');">
                            <button type="submit" class="mdc-button mdc-button--outlined">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<section style="margin-top:2rem;">
  <h3>Create New Story Template</h3>
  <form method="post" action="/stories/create">
    <label for="slug">Slug</label>
    <input id="slug" name="slug" placeholder="space_explorer" required>

    <label for="name">Name</label>
    <input id="name" name="name" placeholder="Space Explorer" required>

    <label for="description">Description</label>
    <textarea id="description" name="description" placeholder="Short summary"></textarea>

    <label for="age">Age</label>
    <input id="age" name="age" placeholder="6-8">

    <label for="version">Version</label>
    <input id="version" name="version" type="number" min="1" value="1" required>

    <label for="workflow_slug">Workflow Slug</label>
    <input id="workflow_slug" name="workflow_slug" value="base">

    <label for="price_dollars">Base Price (AUD)</label>
    <input id="price_dollars" name="price_dollars" type="number" step="0.01" min="0" value="1.50" required>

    <label for="discount_price">Discount Price (AUD)</label>
    <input id="discount_price" name="discount_price" type="number" step="0.01" min="0" placeholder="Optional">

    <label for="free_trial_slug">Free Trial Slug</label>
    <input id="free_trial_slug" name="free_trial_slug" placeholder="winter_free_trial">

    <label for="is_active">Active</label>
    <select id="is_active" name="is_active">
      <option value="true" selected>True</option>
      <option value="false">False</option>
    </select>

    <label for="pages">Pages JSON</label>
    <p style="margin-top:-0.5rem; font-size:0.9rem; color:#555;">Include optional <code>"seed"</code> per page to force deterministic ComfyUI outputs.</p>
    <textarea id="pages" name="pages" style="min-height:260px;" placeholder='[{"page_number":1,"story_text":"...","image_prompt":"...","positive_prompt":"...","image_kp":"default_pose","seed":123456789}]' required></textarea>

    <button type="submit" class="button button-primary">Create Story Template</button>
  </form>
</section>

<a href="/dashboard" class="mdc-button" style="margin-top: 2rem;">Back to dashboard</a>
{% endblock %}
