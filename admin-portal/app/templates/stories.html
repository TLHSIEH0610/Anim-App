{% extends "base.html" %}

{% block content %}
<h2>Story Templates</h2>

<table>
  <thead>
    <tr>
      <th>Slug</th>
      <th>Name</th>
      <th>Age</th>
      <th>Version</th>
      <th>Workflow</th>
      <th>Active</th>
      <th>Pages</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for story in stories %}
    <tr>
      <td>{{ story.slug }}</td>
      <td>{{ story.name }}</td>
      <td>{{ story.age }}</td>
      <td>{{ story.version }}</td>
      <td>{{ story.workflow_slug }}</td>
      <td>{{ story.is_active }}</td>
      <td>{{ story.page_count }}</td>
      <td>
        <a href="/stories/{{ story.slug }}">Edit</a>
        <form method="post" action="/stories/{{ story.slug }}/export" style="display:inline-block; margin-left:0.5rem;">
          <button type="submit" class="button-outline" style="padding:0.35rem 0.75rem;">Export</button>
        </form>
        <form method="post" action="/stories/{{ story.slug }}/delete" style="display:inline-block; margin-left:0.5rem;" onsubmit="return confirm('Delete story template {{ story.slug }}?');">
          <button type="submit" class="button button-danger">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<section style="margin-top:2rem;">
  <h3>Create New Story Template</h3>
  <form method="post" action="/stories/create">
    <label for="slug">Slug</label>
    <input id="slug" name="slug" placeholder="space_explorer" required>

    <label for="name">Name</label>
    <input id="name" name="name" placeholder="Space Explorer" required>

    <label for="description">Description</label>
    <textarea id="description" name="description" placeholder="Short summary"></textarea>

    <label for="age">Age</label>
    <input id="age" name="age" placeholder="6-8">

    <label for="version">Version</label>
    <input id="version" name="version" type="number" min="1" value="1" required>

    <label for="workflow_slug">Workflow Slug</label>
    <input id="workflow_slug" name="workflow_slug" value="base">

    <label for="price_dollars">Base Price (AUD)</label>
    <input id="price_dollars" name="price_dollars" type="number" step="0.01" min="0" value="1.50" required>

    <label for="discount_price">Discount Price (AUD)</label>
    <input id="discount_price" name="discount_price" type="number" step="0.01" min="0" placeholder="Optional">

    <label for="free_trial_slug">Free Trial Slug</label>
    <input id="free_trial_slug" name="free_trial_slug" placeholder="winter_free_trial">

    <label for="is_active">Active</label>
    <select id="is_active" name="is_active">
      <option value="true" selected>True</option>
      <option value="false">False</option>
    </select>

    <label for="pages">Pages JSON</label>
    <textarea id="pages" name="pages" style="min-height:260px;" placeholder='[{"page_number":1,"story_text":"...","image_prompt":"...","positive_prompt":"...","image_kp":"default_pose"}]' required></textarea>

    <button type="submit" class="button button-primary">Create Story Template</button>
  </form>
</section>

<a href="/dashboard" style="margin-top: 2rem; display: inline-block;">Back to dashboard</a>
{% endblock %}
