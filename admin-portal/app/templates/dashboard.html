{% extends "base.html" %}

{% block content %}
<h2>Books Overview</h2>

{% if books %}
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Status</th>
            <th>Progress</th>
            <th>Story</th>
            <th>Created</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for book in books %}
        <tr>
            <td>{{ book.id }}</td>
            <td>{{ book.title }}</td>
            <td>{{ book.status }}</td>
            <td>{{ '%.0f'|format(book.progress_percentage or 0) }}%</td>
            <td>
              {% if book.story_source == 'template' %}
                Template ({{ book.template_key or 'story' }})
              {% else %}
                Custom
              {% endif %}
            </td>
            <td>{{ book.created_at or '-' }}</td>
            <td class="actions">
                <a href="/books/{{ book.id }}/workflow">Workflow</a>
                <a href="/books/{{ book.id }}/images">Images</a>
                <form method="post" action="/books/{{ book.id }}/regenerate" style="margin-top:0.5rem;">
                    <input type="text" name="new_prompt" placeholder="New prompt (optional)">
                    <button type="submit">Regenerate</button>
                </form>
                <form method="post" action="/books/{{ book.id }}/delete" style="margin-top:0.5rem;" onsubmit="return confirm('Delete book {{ book.title }}?');">
                    <button type="submit" class="button-outline">Delete</button>
                </form>
            </td>
        </tr>
        {% if book.original_image_paths %}
        <tr>
            <td colspan="7">
                <strong>Original Images:</strong>
                <code>{{ book.original_image_paths }}</code>
            </td>
        </tr>
        {% endif %}
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>No books found.</p>
{% endif %}

{% endblock %}
