# AnimApp Cross-Platform Setup Guide

This guide helps you run AnimApp on both **macOS** (development) and **Windows PC** (production).

## ğŸ–¥ï¸ Platform-Specific Paths

### **macOS (Development)**
- **Media Storage**: `~/Documents/AnimApp/media/`
- **Workflows**: `~/Documents/AnimApp/workflows/`
- **Database**: `localhost:5432` (local PostgreSQL)
- **Redis**: `localhost:6379` (local Redis)
- **ComfyUI**: `127.0.0.1:8188` (local ComfyUI)

### **Windows PC (Production)**
- **Media Storage**: `C:\Users\{username}\Documents\AnimApp\media\`
- **Workflows**: `C:\Users\{username}\Documents\AnimApp\workflows\`
- **Database**: `localhost:5432` (local PostgreSQL)
- **Redis**: `localhost:6379` (local Redis)
- **ComfyUI**: `127.0.0.1:8188` (local ComfyUI)

---

## ğŸš€ Quick Setup

### **Step 1: Auto Setup**
```bash
cd backend
python setup_platform.py
```
This creates all directories and configuration files automatically.

### **Step 2: Install Dependencies**
```bash
pip install -r requirements.txt
```

### **Step 3: Setup Services**

#### **PostgreSQL**
```bash
# macOS (using Homebrew)
brew install postgresql
brew services start postgresql
createdb animapp

# Windows (using installer)
# Download from: https://www.postgresql.org/download/windows/
# Create database: animapp
```

#### **Redis**
```bash
# macOS
brew install redis
brew services start redis

# Windows
# Download from: https://github.com/microsoftarchive/redis/releases
# Or use Docker: docker run -p 6379:6379 redis:alpine
```

#### **ComfyUI Setup**
```bash
# Clone ComfyUI
git clone https://github.com/comfyanonymous/ComfyUI.git
cd ComfyUI

# Install dependencies
pip install -r requirements.txt

# Start with API enabled
python main.py --listen
```

---

## ğŸ”§ Configuration Files

### **.env File** (auto-generated by setup script)
```env
DATABASE_URL=postgresql://arnie:password@localhost:5432/appdb
REDIS_URL=redis://localhost:6379/0
COMFYUI_SERVER=127.0.0.1:8188
MEDIA_ROOT=~/Documents/AnimApp/media
COMFYUI_WORKFLOW=~/Documents/AnimApp/workflows/image_to_animation.json
```

### **ComfyUI Workflow**
1. Create your image-to-animation workflow in ComfyUI
2. Export as JSON: `Save -> Save (API Format)`
3. Save to: `~/Documents/AnimApp/workflows/image_to_animation.json`

---

## ğŸƒâ€â™‚ï¸ Running the App

### **Development (macOS)**
```bash
# Terminal 1: Start ComfyUI
cd ComfyUI
python main.py --listen

# Terminal 2: Start Backend
cd backend
uvicorn app.main:app --reload

# Terminal 3: Start Worker
cd backend
python -m rq worker jobs

# Terminal 4: Start Frontend
cd frontend
npm start
```

### **Production (Windows)**
Same commands work on Windows with PowerShell or Command Prompt.

---

## ğŸ§ª Testing the Integration

### **1. Upload Test**
- Use the green "Mock Login" button to log in
- Pick an image and upload
- Should see: `âœ… Job queued: #1`

### **2. Check Processing**
```bash
# Check job status in database or API
curl http://localhost:8000/jobs/status/1
```

### **3. File Structure Check**
After upload, you should see:
```
~/Documents/AnimApp/media/
â”œâ”€â”€ inputs/
â”‚   â””â”€â”€ uploaded_image.png
â””â”€â”€ outputs/
    â””â”€â”€ animated_uploaded_image.png
```

---

## ğŸ”§ ComfyUI Integration Steps

### **1. Create Your Workflow**
1. Open ComfyUI web interface
2. Build image-to-animation workflow
3. Test with sample image
4. Save as API format JSON

### **2. Update Workflow Integration**
The `ComfyUIClient` automatically:
- Uploads your image to ComfyUI
- Runs the workflow
- Downloads the result
- Saves to local storage

### **3. Customize for Your Workflow**
Edit `comfyui_client.py` if needed:
- Update `_prepare_workflow()` for your node structure
- Update `_download_result()` for your output format

---

## ğŸ› Troubleshooting

### **ComfyUI Not Working**
- App falls back to mock processing automatically
- Check ComfyUI is running: `http://127.0.0.1:8188`
- Check workflow file exists and is valid JSON

### **Database Issues**
- Ensure PostgreSQL is running
- Check connection string in `.env`
- Create database if it doesn't exist

### **Path Issues**
- All paths use Python's `pathlib` for cross-platform compatibility
- Check directories exist: `~/Documents/AnimApp/media/`

### **Worker Issues**
```bash
# Check Redis connection
redis-cli ping

# Check RQ worker
python -m rq worker jobs --url redis://localhost:6379/0
```

---

## ğŸ”„ Moving Between Platforms

### **From macOS to Windows**
1. Copy your ComfyUI workflow JSON file
2. Run `python setup_platform.py` on Windows
3. Update database and Redis URLs if needed
4. Install services (PostgreSQL, Redis)

### **Shared Components**
- All Python code is cross-platform
- Database schema is identical
- Frontend works on both platforms
- ComfyUI workflows are portable

---

## ğŸ“ Summary

âœ… **Cross-platform file paths** using `pathlib`  
âœ… **Platform-specific defaults** for directories  
âœ… **Automatic fallback** to mock processing  
âœ… **Easy setup script** for both platforms  
âœ… **Identical functionality** on macOS and Windows  

Your app will work seamlessly on both platforms! ğŸ‰